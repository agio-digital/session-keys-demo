yarn commitlint --edit $1

# Remove Claude attribution if present
if command -v grep >/dev/null 2>&1 && command -v awk >/dev/null 2>&1; then
  TMP_MSG_FILE="$1.claude_clean.$$"

  # Remove lines containing Claude attribution
  grep -vF "ðŸ¤– Generated with" "$1" | grep -vF "Co-Authored-By" > "$TMP_MSG_FILE"

  # Clean up blank lines
  awk '
    BEGIN { content_started = 0; pending_blank = 0 }
    NF {
      if (!content_started) content_started = 1
      else if (pending_blank) print ""
      print $0
      pending_blank = 0
      next
    }
    !NF { if (content_started) pending_blank = 1 }
  ' "$TMP_MSG_FILE" > "$1"

  rm -f "$TMP_MSG_FILE"
fi
